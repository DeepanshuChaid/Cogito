// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
}

model User {
  id String @id @default(uuid()) @db.Uuid

  name     String  @unique
  email    String  @unique
  password String?

  profilePicture String?
  isVerified     Boolean @default(false)

  instagram String?
  facebook  String?
  bio       String?

  following Follow[] @relation("follower")
  followers Follow[] @relation("following")

  blogReaction Blogreaction[]

  accounts   Account[]
  blogs      Blog[]
  savedBlogs Savedblogs[]

  comments Comments[]

  notificationsReceived Notification[] @relation("NotificationReceiver")
  notificationsIssued   Notification[] @relation("NotificationIssuer")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([name])
}


enum NotificationType {
  FOLLOW
  BLOG_LIKE
  COMMENT
}

model Notification {
  id          String           @id @default(uuid()) @db.Uuid
  type        NotificationType
  isRead      Boolean          @default(false)

  // The user who receives the notification
  receiverId  String           @db.Uuid
  receiver    User             @relation("NotificationReceiver", fields: [receiverId], references: [id], onDelete: Cascade)

  // The user who performed the action (e.g., the person who liked the blog)
  issuerId    String           @db.Uuid
  issuer      User             @relation("NotificationIssuer", fields: [issuerId], references: [id], onDelete: Cascade)

  // Optional: Link to the specific content
  blogId      String?          @db.Uuid
  
  commentId   String?          @db.Uuid
  commentText String?          @db.Uuid

  createdAt   DateTime         @default(now())

  @@index([receiverId])
  @@index([isRead])
}


model Follow {
  id           String    @id @default(uuid()) @db.Uuid

  follower User @relation("follower", fields: [followerId], references: [id])
  followerId String @db.Uuid

  following User @relation("following", fields: [followingId], references: [id])
  followingId String @db.Uuid

  createdAt DateTime @default(now())

  @@unique([followerId, followingId])
  @@index([followingId])
  @@index([followerId])
}

enum Provider {
  EMAIL
  GOOGLE
}

model Account {
  id           String    @id @default(uuid()) @db.Uuid
  provider     Provider
  providerId   String?
  refreshToken String?
  tokenExpiry  DateTime?

  userId String @db.Uuid
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Blog {
  id          String         @id @default(uuid()) @db.Uuid
  title       String
  description String
  blogContent String
  image       String
  category    BlogCategory[]

  views  Int @default(0)
  shares Int @default(0)

  likesCount Int @default(0)
  dislikesCount Int @default(0)

  engagementScore  Float   @default(0)

  blogReaction Blogreaction[]

  author   User   @relation(fields: [authorId], references: [id], onDelete: Cascade)
  authorId String @db.Uuid

  comments Comments[]

  savedBlogs Savedblogs[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([authorId])
  @@index([engagementScore])
  @@index([createdAt])
}

enum ReactionType {
  LIKE
  DISLIKE
}

model Blogreaction {
  id   String       @id @default(uuid()) @db.Uuid
  type ReactionType

  userId String @db.Uuid
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  blogId String @db.Uuid
  blog   Blog   @relation(fields: [blogId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@index([blogId])
  @@index([userId])
  @@unique([userId, blogId]) // one reaction per user
}

model Comments {
  id      String @id @default(uuid()) @db.Uuid
  comment String
  isEdited Boolean @default(false)

  parentId String?   @db.Uuid
  parent   Comments? @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)

  replies Comments[] @relation("CommentReplies")

  blog   Blog   @relation(fields: [blogId], references: [id], onDelete: Cascade)
  blogId String @db.Uuid

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String @db.Uuid

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([blogId])
  @@index([userId])
}

model Savedblogs {
  id String @id @default(uuid()) @db.Uuid

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String @db.Uuid

  blog   Blog   @relation(fields: [blogId], references: [id], onDelete: Cascade)
  blogId String @db.Uuid

  createdAt DateTime @default(now())

  @@index([blogId])
  @@index([userId])
  @@unique([userId, blogId])
}

enum BlogCategory {
  TECHNOLOGY
  PROGRAMMING
  WEB_DEVELOPMENT
  MOBILE_DEVELOPMENT
  CLOUD_COMPUTING
  AI_ML
  CYBERSECURITY
  DEVOPS
  DATA_SCIENCE
  UI_UX
  SOFTWARE_ENGINEERING

  BUSINESS
  STARTUPS
  MARKETING
  ENTREPRENEURSHIP
  FINANCE
  INVESTING
  ECOMMERCE
  PRODUCTIVITY
  LEADERSHIP
  PERSONAL_DEVELOPMENT

  HEALTH
  FITNESS
  NUTRITION
  MENTAL_HEALTH
  SELF_CARE
  MEDICINE

  EDUCATION
  STUDY_TIPS
  LEARNING
  MOTIVATION

  ENTERTAINMENT
  MOVIES
  TV_SHOWS
  ANIME
  GAMING
  MUSIC
  CELEBRITY

  LIFESTYLE
  TRAVEL
  FOOD
  COOKING
  FASHION
  BEAUTY
  RELATIONSHIPS
  PARENTING
  MINIMALISM

  NEWS
  POLITICS
  WORLD
  CURRENT_EVENTS

  SPORTS
  FOOTBALL
  CRICKET
  BASKETBALL
  MMA
  BOXING
  ESPORTS

  ART
  DESIGN
  PHOTOGRAPHY
  WRITING
  POETRY
  BOOKS

  SCIENCE
  ASTRONOMY
  PHYSICS
  CHEMISTRY
  BIOLOGY
  SPACE

  FINTECH
  CRYPTO
  BLOCKCHAIN
  WEB3
  NFT

  RANDOM
  HUMOR
  MEMES
  STORYTIME
  OPINION

  HISTORY
  CULTURE
  PHILOSOPHY
  RELIGION
  ETHICS
  ENVIRONMENT
  CLIMATE
  DIY
  HOME
  GARDENING
  PETS
  AUTOMOTIVE
  ENGINEERING
  HARDWARE
  REVIEWS
  HOW_TO
  GUIDES
  CAREER
  FREELANCING
  REMOTE_WORK

  /// ðŸ”ž ADULT / SEXUALITY SECTION
  SEX_EDUCATION
  SEXUAL_HEALTH
  RELATIONSHIP_ADVICE
  DATING_TIPS
  INTIMACY
  BODY_POSITIVITY
  KINK_DISCUSSION
  LGBTQ_TOPICS
  CONSENT_AND_SAFETY
  ADULT_STORIES
}




